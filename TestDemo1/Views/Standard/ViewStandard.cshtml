@model IEnumerable<TestDemo1.Models.StandardModel>

@{
    ViewData["title"] = "STUDENT STANDARD DETAILS";
}
<H2>@ViewData["title"]</H2>

<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addstandard">
    AddStandard
</button>

<div class="modal fade" id="addstandard" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEmployeeLabel">Add Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm" name="addstandard">

                    <div class="mb-3">
                        <label for="StudentName" class="form-label">StudentName : </label>
                        <input id="StudentName" type="text" name="StudentName" class="form-control" autocomplete="off" />
                        <span id="StudentNameError" style="color: red; display: none; font-size: 10px;"></span>
                    </div>

                    <div class="form-group">
                        <label for="teacherName">TeacherName:</label>
                        <select id="teacherName" name="teacherName" class="form-control">
                            <option value="" disabled selected>Select</option>

                            @if (ViewBag.TeacherList != null)
                            {
                                foreach (var teacherName in ViewBag.TeacherList)
                                {
                                    <option value="@teacherName">@teacherName</option>
                                }
                            }
                            else
                            {
                                <option value="" disabled>No teachers available</option>
                            }
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="Standard">Standard:</label>
                        <select id="Standard" name="Standard" class="form-control">
                            <option value="" disabled selected>Select</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="Section">Section:</label>
                        <select id="Section" name="Section" class="form-control">
                            <option value="" disabled selected>Select</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="Age">Age:</label>
                        <input id="Age" type="number" name="Age" class="form-control" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>Gender:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="Gender" id="Male" value="Male">
                            <label class="form-check-label" for="Male">
                                Male
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="Gender" id="Female" value="Female">
                            <label class="form-check-label" for="Female">
                                Female
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="Address">Address:</label>
                        <input id="Address" type="text" name="Address" autocomplete="off" class="form-control">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" id="submit" onclick="AddStandard()">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>





@* <<--UpdateStandardModal-->> *@

<div class="modal fade" id="updateStandardModal" tabindex="-1" role="dialog" aria-labelledby="updateStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Update Standard Details</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>
            <div class="modal-body">
                <form>

                    <div class="form-group">
                        <label for="UStudentId" class="col-form-label">StudentId:</label>
                        <input type="text" class="form-control" id="UStudentId" hidden>
                    </div>

                    <div class="form-group">
                        <label for="UName" class="col-form-label">StudentName:</label>
                        <input type="text" class="form-control" id="UName">
                    </div>

                    <div class="form-group">
                        <label for="UStandard" class="col-form-label">Standard:</label>
                        <input type="text" class="form-control" id="UStandard">
                    </div>

                    <div class="form-group">
                        <label for="USection" class="col-form-label">Section:</label>
                        <input type="text" class="form-control" id="USection">
                    </div>

                    <div class="form-group">
                        <label for="UAge" class="col-form-label">Age:</label>
                        <input type="text" class="form-control" id="UAge">
                    </div>

                    <div class="form-group">
                        <label for="UGender" class="col-form-label">Gender:</label>
                        <input type="text" class="form-control" id="UGender">
                    </div>

                    <div class="form-group">
                        <label for="UAddress" class="col-form-label">Address:</label>
                        <input type="text" class="form-control" id="UAddress">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="updateButton" onclick="UpdateStandard()">Update</button>
            </div>
        </div>
    </div>
</div>

@if (Model != null)
{

    <table class="table" id="standard-table">

        <thead>
            <tr>
                <th>Student Id</th>
                <th>Student Name</th>
                <th>TeacherName</th>
                <th>Standard</th>
                <th>Section</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Address</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.StudentId)</td>
                    <td>@Html.DisplayFor(modelItem => item.StudentName)</td>
                    <td>@Html.DisplayFor(modelItem => item.teacherName)</td>
                    <td>@Html.DisplayFor(modelItem => item.Standard)</td>
                    <td>@Html.DisplayFor(modelItem => item.Section)</td>
                    <td>@Html.DisplayFor(modelItem => item.Age)</td>
                    <td>@Html.DisplayFor(modelItem => item.Gender)</td>
                    <td>@Html.DisplayFor(modelItem => item.Address)</td>
                    <td>

                        <a class="btn btn-info" onclick="PopulateUpdateStandard(@item.StudentId)" data-bs-toggle="modal" data-bs-target="#updateStandardModal">Update</a>
                        @*  <a class="btn btn-primary" onclick="ViewStudents(@item.StudentId)" data-bs-toggle="modal" data-bs-target="#viewStudentModal">View</a> *@
                        <a class="btn btn-danger" onclick="DeleteStandard(@item.StudentId)">Delete</a>



                        @*  <a class="btn btn-success" asp-action="updatestudent" asp-route-studentid="@item.studentid">update</a>
                <a class="btn btn-danger" asp-action="deletestudent" asp-route-studentid="@item.studentid">delete</a> |
                *@
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <h2>No Data Available</h2>
}




<script>


    function openModal() {
        $(".modal").modal("show")
    }

    $('#updateStandardModal').on('click', 'button.close', function (eventObject) {
        $('#updateStandardModal').modal('hide');
    });

    function validateForm() {
        var StudentName = $("#StudentName").val();
        var teacherName = $("#teacherName").val();
        var Standard = $("#Standard").val();
        var Section = $("#Section").val();
        var Age = $("#Age").val();
        var Gender = $('input[name="Gender"]:checked').val();
        var Address = $("#Address").val();


        if (StudentName == "" || teacherName == "" || Standard == "" || Section == "" || Age == "" || Gender == "" || Address == "") {
            alert("All fields must be filled out");
            return false;
        }


        if (isNaN(Age) || Age < 1) {
            alert("Please enter a valid age");
            return false;
        }


        return true;
    }

    function AddStandard() {
        debugger;

        if (!validateForm()) {
            return;
        }

        var standardDetails = {
            StudentId: $("#StudentId").val(),
            StudentName: $("#StudentName").val(),
            teacherName: $("#teacherName").val(),
            Standard: $("#Standard").val(),
            Section: $("#Section").val(),
            Age: $("#Age").val(),
            Gender: $('input[name="Gender"]:checked').val(),
            Address: $("#Address").val()
        }

        var formData = new FormData();
        for (var key in standardDetails) {
            formData.append(key, standardDetails[key]);
        }

        $.ajax({
            type: "POST",
            url: "/Standard/AddStandard",
            data: formData,
            contentType: false,
            processData: false,
            cache: false,
            success: function (data) {
                Swal.fire({
                    title: "Good job!",
                    text: "Data updated successfully",
                    icon: "success",
                    confirmButtonText: "Ok",
                });
                window.location.href = '/Standard/ViewStandard';
            },
            error: function (error) {
                console.log("Error, when saving standard:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An error occurred. Please try again.'
                });
            }
        });
    }


    // function AddStandard() {
    //     debugger;

    //     if (!validateForm()) {
    //         return;
    //     }

    //     var StudentName = $("#StudentName").val();
    //     var teacherName = $("#teacherName").val();
    //     var Standard = $("#Standard").val();
    //     var Section = $("#Section").val();
    //     var Age = $("#Age").val();
    //     var Gender = $('input[name="Gender"]:checked').val();
    //     var Address = $("#Address").val();

    //     var oModel = {
    //         StudentName:this.StudentName,
    //         teacherName: this.teacherName,
    //         Standard: this.Standard,
    //         Section: this.Section,
    //         Age: this.Age,
    //         Gender: this.Gender,
    //         Address: this.Address
    //     };

    // var oModel = {
    //     StudentName = $("#StudentName").val(),
    //     teacherName = $("#teacherName").val(),
    //     Standard = $("#Standard").val(),
    //     Section = $("#Section").val(),
    //     Age = $("#Age").val(),
    //     Gender = $('input[name="Gender"]:checked').val(),
    //     Address = $("#Address").val(),
    // }
    debugger;
    // $.ajax({
    //     type: "POST",
    //     url: "/Standard/AddStandard",
    //     contentType: "application/json",
    //     data: JSON.stringify(oModel),
    //     dataType: 'json',
    //     cache: false,
    //     success: function (data) {

    //     var formData = new FormData();
    //     formData.append("standard", JSON.stringify(oModel));
    //     $.ajax({
    //         type: "POST",
    //         url: "/Standard/AddStandard",
    //         contentType: "application/json",
    //         data: JSON.stringify(oModel),
    //         dataType: 'json',
    //         cache: false,
    //         async: false,
    //         success: function (data) {
    //             Swal.fire({
    //                 title: "Good job!",
    //                 text: "Data inserted successfully",
    //                 icon: "success",
    //                 button: "Ok",
    //             });
    //         },
    //         error: function (errorThrown) {
    //             console.log("Error saving data:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while saving your data, Please try again later.", "error");
    //         }
    //     });
    // }



    // function AddStandard() { <<---Working-->>
    //     debugger;


    //     if (!validateForm()) {
    //         return;
    //     }

    //     var StudentName = $("#StudentName").val();
    //     var teacherName = $("#teacherName").val();
    //     var Standard = $("#Standard").val();
    //     var Section = $("#Section").val();
    //     var Age = $("#Age").val();
    //     var Gender = $('input[name="Gender"]:checked').val();
    //     var Address = $("#Address").val();

    //     var oModel = {
    //         StudentName: StudentName,
    //         teacherName: teacherName,
    //         Standard: Standard,
    //         Section: Section,
    //         Age: Age,
    //         Gender: Gender,
    //         Address: Address
    //     };

    //     $.ajax({
    //         type: "POST",
    //         url: "/Standard/AddStandard",
    //         contentType: "application/json",
    //         data: JSON.stringify(oModel),
    //         dataType: 'json',
    //         cache: false,
    //         success: function (data) {

    //             console.log(data);

    //         },
    //         error: function (errorThrown) {
    //             console.log("Error saving data:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while saving your data, Please try again later.", "error");
    //         }
    //     });
    // }


    // function AddStandard() {   <<--Not Working-->>
    //     debugger;

    //     // Validate the form
    //     if (!validateForm()) {
    //         return;
    //     }

    //     var StudentName = $("#StudentName").val();
    //     var teacherName = $("#teacherName").val();
    //     var Standard = $("#Standard").val();
    //     var Section = $("#Section").val();
    //     var Age = $("#Age").val();
    //     var Gender = $('input[name="Gender"]:checked').val();
    //     var Address = $("#Address").val();

    //     var oModel = { StudentName: StudentName, teacherName: teacherName, Standard: Standard, Section: Section, Age: Age, Gender: Gender, Address: Address };

    //     $.ajax({
    //         type: "POST",
    //         url: "/Standard/AddStandard",
    //         contentType: "application/json",
    //         data: JSON.stringify(oModel),
    //         dataType: 'json',
    //         cache: false,
    //         async: false,
    //         success: function (data) {
    //             Swal.fire({
    //                 title: "Good job!",
    //                 text: "Data updated successfully",
    //                 icon: "success",
    //                 confirmButtonText: "Ok",
    //             }).then((result) => {
    //                 if (result.isConfirmed) {
    //                     location.reload();
    //                 }
    //             });
    //         },

    //         error: function (errorThrown) {
    //             console.log("Error saving employee:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while saving your data, Please try again later.", "error");
    //         }
    //     });
    // }



    // $(document).ready(function () {
    //     $("#submitBtn").click(function () {
    //         AddStandard();
    //         });
    //     });

    // function functionBindAddstandard()
    // {
    //     var oModel = {};

    //         oModel.StudentName = $("#StudentName").val();
    //         oModel.Standard = $("#Standard").val();
    //         oModel.Section = $("#Section").val();
    //         oModel.Age = parseInt($('#Age').val());
    //         oModel.Gender = $('#Gender').val();
    //         oModel.Address = $('#Address').val();
    //     return oModel;
    // }

    // function AddStudent() {
    //     var StudentName = $("#StudentName").val();
    //     var StudentAddress = $("#StudentAddress").val();
    //     var StudentAge = $("#StudentAge").val();

    //     var oModel = { StudentName: StudentName, StudentAddress: StudentAddress, StudentAge: StudentAge };

    //     var formData = new FormData();
    //     for (var key in oModel) {
    //         formData.append(key, oModel[key]);
    //     }

    //     $.ajax({
    //         type: "POST",
    //         url: "/Students/AddStudent",
    //         data: formData,
    //         processData: false,
    //         contentType: false,
    //         cache: false,
    //         success: function (data) {
    //             if (data) {
    //                 Swal.fire({
    //                     title: "Good job!",
    //                     text: "Data inserted successfully",
    //                     icon: "success",
    //                     button: "Ok",
    //                 });
    //             }
    //         },
    //         error: function (errorThrown) {
    //             console.log("Error saving employee:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while saving your data, Please try again later.", "error");
    //         }
    //     });
    // }

    // function AddStandard() {    <<--Working code-->>
    //     debugger;
    //     var StudentName = $("#StudentName").val();
    //     var Standard = $("#Standard").val();
    //     var Section = $("#Section").val();
    //     var Age = $("#Age").val();
    //     //var Gender = $("#Gender").val();
    //     var Gender = $('input[name="Gender"]:checked').val();
    //     var Address = $("#Address").val();

    //     var oModel = { StudentName: StudentName, Standard: Standard, Section: Section, Age: Age, Gender: Gender, Address: Address };

    //     $.ajax({
    //         type: "POST",
    //         url: "/Standard/AddStandard",
    //        // data: formData,
    //         contentType: "application/json",
    //         data: JSON.stringify(oModel),
    //         dataType: 'json',
    //          cache: false,
    //          async: false,
    //         success: function (data) {
    //             Swal.fire({
    //                 title: "Good job!",
    //                 text: "Data updated successfully",
    //                 icon: "success",
    //                 confirmButtonText: "Ok",
    //             }).then((result) => {
    //                 if (result.isConfirmed) {
    //                     location.reload();
    //                 }
    //             });
    //         },

    //         error: function (errorThrown) {
    //             console.log("Error saving employee:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while saving your data, Please try again later.", "error");
    //         }
    //     });
    // }

    function PopulateUpdateStandard(StudentId) {
        debugger;
        $.ajax({
            type: "GET",
            url: "/Standard/PopulateUpdateStandard?studentid=" + StudentId,
            success: function (data) {
                debugger;
                // Assuming 'data' is an object with standard details
                $('#UStudentId').val(data.studentId);
                $('#UName').val(data.studentName);
                $('#UStandard').val(data.standard);
                $('#USection').val(data.section);
                $('#UAge').val(data.age);
                $('#UGender').val(data.gender);
                $('#UAddress').val(data.address);
            },
            error: function (errorThrown) {
                console.log("Error fetching standard:", errorThrown);
                Swal.fire("Oops", "An error occurred while fetching your data, Please try again later.", "error");
            }
        });
    }

    function UpdateStandard() {
        debugger;

        if (!validateForm()) {
            return;
        }

        var studentID = {
            StudentId: $('#UStudentId').val()
        }

        // var StudentId = $("#UStudentId").val();
        var oModel = {
            StudentName: $("#UName").val(),
            Standard: $("#UStandard").val(),
            Section: $("#USection").val(),
            Age: $("#UAge").val(),
            Gender: $("#UGender").val(),
            Address: $("#UAddress").val()
        }


        // var oModel = { StudentId: StudentId, StudentName: StudentName, Standard: Standard, Section: Section, Age: Age, Gender: Gender, Address: Address };
        debugger;
        var formData = new FormData();
        formData.append("Id", studentID.StudentId);
        formData.append("model", JSON.stringify(oModel));
        $.ajax({
            type: "POST",
            url: "/Standard/UpdateStandard",
            data: formData,
            // contentType: "application/json",
            // dataType: 'json',
            // cache: false,
            // async: false,
            processData: false,
            contentType: false,
            cache: false,
            success: function (data) {

                Swal.fire({
                    title: "Good job!",
                    text: "Data updated successfully",
                    icon: "success",
                    button: "Ok",
                });

            },
            error: function (errorThrown) {
                console.log("Error updating student:", errorThrown);
                Swal.fire("Oops", "An error occurred while updating your data, Please try again later.", "error");
            }
        });
    }



    // function UpdateStandard() {
    //     debugger;
    //     var StudentId = $("#UStudentId").val();
    //     var StudentName = $("#UName").val();
    //     var Standard = $("#UStandard").val();
    //     var Section = $("#USection").val();
    //     var Age = $("#UAge").val();
    //     var Gender = $("#UGender").val();
    //     var Address = $("#UAddress").val();
    //     var oModel = { StudentId: StudentId, StudentName: StudentName, Standard: Standard, Section: Section, Age: Age, Gender: Gender, Address: Address };
    //     var formData = new FormData();
    //     for (var key in oModel) {
    //         formData.append(key, oModel[key]);
    //     }
    //     $.ajax({
    //         type: "POST",
    //         url: "/Standard/UpdateStandard/",
    //         data: formData,
    //         processData: false,
    //         contentType: false,
    //         cache: false,
    //         success: function (data) {
    //             if (data) {
    //                 Swal.fire({
    //                     title: "Good job!",
    //                     text: "Data updated successfully",
    //                     icon: "success",
    //                     button: "Ok",
    //                 });
    //             }
    //         },
    //         error: function (errorThrown) {
    //             console.log("Error updating Details:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while updating your data, Please try again later.", "error");
    //         }
    //     });
    // }


    // function UpdateStandard(StudentId) {
    //     debugger;
    //     var StudentId = $("#UStudentId").val();
    //     var StudentName = $("#UName").val();
    //     var Standard = $("#UStandard").val();
    //     var Section = $("#USection").val();
    //     var Age = $("#UAge").val();
    //     var Gender = $("#UGender").val();
    //     var Address = $("#UAddress").val();

    //     var oModel = { StudentId: StudentId, StudentName: StudentName, Standard: Standard, Section: Section, Age: Age, Gender: Gender, Address: Address };

    //     var formData = new FormData();
    //     for (var key in oModel) {
    //         formData.append(key, oModel[key]);
    //     }

    //     $.ajax({
    //         type: "POST",
    //         url: "/Standard/UpdateStandard/",
    //         data: formData,
    //         processData: false,
    //         contentType: false,
    //         cache: false,
    //         success: function (data) {
    //             if (data) {
    //                 Swal.fire({
    //                     title: "Good job!",
    //                     text: "Data updated successfully",
    //                     icon: "success",
    //                     button: "Ok",
    //                 });
    //             }
    //         },
    //         error: function (errorThrown) {
    //             console.log("Error updating student:", errorThrown);
    //             Swal.fire("Oops", "An error occurred while updating your data, Please try again later.", "error");
    //         }
    //     });
    // }


    function DeleteStandard(StudentId) {
        if (confirm("Are you sure you want to delete this Student?")) {
            $.ajax({
                type: "POST", // or "GET" depending on your server-side implementation
                url: "/Standard/DeleteStandard?studentid=" + StudentId,
                success: function (data) {
                    alert("Student deleted successfully!");

                    get();
                },
                error: function (error) {
                    console.error("Error deleting Student:", error);
                }
            });
        }
    }

    $(document).ready(function () {
        $.ajax({
            url: '/Teacher/GetTeacherNames',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                var dropdown = $('#teacherName');
                dropdown.empty();
                $.each(data, function (i, teacherName) {
                    dropdown.append($('<option></option>').attr('value', teacherName).text(teacherName));
                });
            },
            error: function () {
                alert('Error occurred while loading teacher names.');
            }
        });
        //debugger;
    });


</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}